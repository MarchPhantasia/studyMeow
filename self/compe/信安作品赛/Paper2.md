> Wang 等 - 2024 - MiniScope Automated UI Exploration and Privacy Inconsistency Detection of MiniApps via Two-phase It

这篇论文提出了一种名为**MiniScope**的方法，用于对MiniApp（小程序）进行自动化UI探索和隐私不一致性检测。以下是MiniScope方法的详细分析，包括其原理、工作方式以及解决的问题：

### 方法概述
**MiniScope**是一种基于两阶段迭代混合分析的框架，专门用于深入分析小程序的UI界面并识别其隐私数据处理行为中的不一致性。它结合了静态分析和动态分析，能够更全面地了解小程序的隐私实践。

### 方法的原理
MiniScope的分析过程分为两个主要阶段，每个阶段都结合了静态分析和动态UI探索，以确保对小程序隐私行为的全面检测：

1. **第一阶段：主包分析（Main Package Analysis）**
   - **目标**：加载小程序的所有子包，从而获得完整的程序包。
   - **过程**：首先，MiniScope通过静态分析生成小程序的依赖图（MiniApp Dependency Graph, MDG），该图包含UI状态转换、回调控制流和数据流等信息。这个初始的MDG为后续的UI探索提供了指导。
   - **动态UI探索**：基于MDG的指导，MiniScope执行子包导向的广度优先遍历（BFS），探索小程序中的子包页面，确保在动态加载时能够全面覆盖所有可能的页面状态。

2. **第二阶段：完整包分析（Full Package Analysis）**
   - **目标**：识别小程序中具体的隐私行为，包括敏感数据的收集、存储和共享。
   - **过程**：在此阶段，MiniScope将静态分析生成的完整依赖图与动态加载的包合并，并基于此执行深度优先遍历（DFS），专注于探索与隐私相关的行为路径。
   - **隐私不一致性检测**：MiniScope通过监控动态执行过程中API调用的实际行为，并将这些行为与隐私政策声明进行交叉验证，识别任何不一致之处。

### 方法的主要组件
1. **MiniApp依赖图生成器（MiniApp Dependency Graph Generator）**：
   - 构建一个描述小程序UI状态转换、回调控制流和数据流的综合图。
   - 这部分基于JavaScript和WXML的代码解析，生成与页面转换、事件驱动的回调函数及数据传播相关的图结构。

2. **定向UI探索器（Directed UI Explorer）**：
   - 动态分析模块，用于指导UI的探索。
   - 在第一阶段使用子包导向的BFS策略，以确保加载所有页面状态。在第二阶段使用隐私实践导向的DFS策略，深入挖掘与隐私相关的行为路径。

3. **隐私不一致性检测器（Privacy Inconsistency Detector）**：
   - 结合静态分析和动态分析结果，识别隐私声明与实际数据操作之间的差异。
   - 通过分析隐私政策文本（借助大型语言模型，如GPT-3.5）和API调用的实际行为，检测出数据收集、存储和共享中的遗漏声明或多余声明。

### 解决的问题
MiniScope主要解决了以下问题：

1. **子包动态加载分析的挑战**：
   - 小程序使用动态加载的子包机制来保持轻量化，仅在需要时加载子包代码。传统静态分析方法难以捕获这些动态加载的内容，导致漏报。
   - MiniScope通过结合动态UI探索与静态分析，确保可以全面加载和分析小程序的所有代码，从而减少漏报。

2. **事件驱动回调分析的复杂性**：
   - 小程序中的许多行为是事件驱动的（如用户点击按钮触发的逻辑），传统的静态分析难以处理这些回调函数的跨文件、跨包调用。
   - MiniScope通过构建回调控制流图（CCFG），精确解析这些回调函数的调用关系，确保能够追踪用户交互行为对数据流的影响。

3. **隐私声明与实际行为的不一致性检测**：
   - 小程序的隐私政策声明和实际的数据操作之间常常存在不一致性，开发者可能会收集超出声明范围的数据或没有披露的隐私行为。
   - MiniScope通过API监控和隐私政策解析，将实际操作与声明内容进行对比，揭示这些不一致性。

### SUMMARY
MiniScope是一种针对小程序的高效隐私分析工具，通过两阶段混合分析方法，在大规模的小程序环境下实现了自动化的UI探索和隐私行为检测。它通过深入的代码和行为分析，有效识别了隐私数据收集中的不一致性，从而提升了对小程序隐私风险的理解和检测能力。这种方法在处理动态加载、事件驱动回调和隐私政策交叉验证方面提供了创新性的解决方案，显著提高了隐私检测的精确度和覆盖率。